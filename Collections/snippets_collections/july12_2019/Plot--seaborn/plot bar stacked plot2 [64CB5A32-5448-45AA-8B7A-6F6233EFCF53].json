{
  "alfredsnippet" : {
    "snippet" : "def stacked_barplot2(df, x, y1, y2):\n    \"\"\"\n    WARNING:\n    The total only works when column x is sring dtype.\n    It does not work for numbers, e.g. year column\n        even if I converted column dtype as str.\n    \n    \"\"\"\n    NUM = 30\n    df1 = df[[x, y1, y2]].copy()\n    df1['y_sum'] = df1[y1] + df1[y2]\n    df1 = (df1.groupby(x)\n           .sum()\n           .reset_index()\n           .sort_values(by=\"y_sum\", ascending=False)[[x, y1, y2]]\n           .head(NUM))\n    \n    plt.figure(figsize=(10, 6))\n    \n    # plot 1\n    ax1 = sns.barplot(x,y2,data=df1,\n                      color=\"b\",\n                      label=y1,\n                      linewidth=.5,\n                      palette='Greens_r',\n                      edgecolor=\"k\" * df1[x].nunique())\n\n    # total text on top of plot\n    for p,d in zip(ax1.patches,df1.values):\n        y_sum = '{:,.0f}'.format(d[1]+d[2])\n        ax1.annotate(y_sum,(p.get_x()+p.get_width()\/2.,p.get_height()),\n                     ha='center', \n                     va='center',\n                     xytext=(0, 10),\n                     rotation=90,\n                     textcoords='offset points')\n        \n    # plot 2\n    ax2 = sns.barplot(x, y1, data=df1,\n                      color=\"r\", \n                      label=y2,\n                      linewidth=.5,\n                      palette = 'Blues_r',\n                      edgecolor=\"k\" * df1[x].nunique())\n    \n    plt.legend(loc=\"best\", prop={\"size\": 15})\n    plt.xticks(rotation=70)\n    plt.title(y1 + \" and \" + y2)\n    plt.grid(True, alpha=.4)\n    plt.show()\n    \n    df1['y_sum'] = df1[y1] + df1[y2]\n    return df1.head()\n\nstacked_barplot2(df, \"\", \"\", \"\")",
    "uid" : "64CB5A32-5448-45AA-8B7A-6F6233EFCF53",
    "name" : "plot bar stacked plot2",
    "keyword" : "stacked_bar_plot2"
  }
}